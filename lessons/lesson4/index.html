<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูููู ุงูููุณุฑ - ุฅุดุฑุงู ุฏ. ุจุงุณู ุงููุฑุงูู</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { navy: '#16213e', gold: '#e2b96f', creamy: '#faf8f3' }, fontFamily: { amiri: ['Amiri', 'serif'], tajawal: ['Tajawal', 'sans-serif'] } } } }
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background: #faf8f3; font-family: 'Tajawal', sans-serif; color: #16213e; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #e2b96f; border-radius: 10px; }
        .verse { font-family: 'Amiri', serif; color: #b45309; text-align: center; font-size: 1.25rem; line-height: 2; padding: 1rem; background: #fffbeb; border: 1px dashed #e2b96f; margin: 1rem 0; border-radius: 0.5rem; }
        
        /* ุงูุจุทุงูุงุช */
        .flip-card { perspective: 1000px; height: 180px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; padding: 1rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .flip-card-front { background: #16213e; color: #e2b96f; border: 2px solid #e2b96f; font-family: 'Amiri', serif; font-size: 1.3rem; }
        .flip-card-back { background: #faf8f3; color: #16213e; border: 2px solid #16213e; transform: rotateY(180deg); font-size: 0.95rem; line-height: 1.6; }
        
        /* ุงูุฎุฑูุทุฉ */
        .map-root { background: #16213e; color: #e2b96f; border: 2px solid #e2b96f; padding: 0.75rem 2rem; border-radius: 1rem; font-weight: bold; font-size: 1.25rem; display: inline-block; margin-bottom: 2rem; position: relative; }
        .map-branch { background: white; border: 1px solid #16213e; position: relative; padding: 1rem; border-radius: 0.5rem; }
        .map-branch::before { content: ''; position: absolute; top: -2rem; left: 50%; width: 2px; height: 2rem; background: #e2b96f; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // ==========================================
        // 1. DATA
        // ==========================================
        
        const TOPICS_DATA = [
            {
                title: 'ุงูุฎูุน: ูุนูุงู ูุฃุฏูุฉ ูุดุฑูุนูุชู', bg: 'bg-green-50',
                content: <div className="space-y-4 text-lg">
                    <p><span className="text-blue-700 font-bold">ุงูุฎูููุนู ูุบุฉู:</span> ูุฃุฎูุฐ ูู ุฎูุน ุงูุซูุจุ ูุฃู ููุงู ูู ุงูุฒูุฌูู ูุจุงุณ ููุขุฎุฑ.</p>
                    <p><span className="text-blue-700 font-bold">ุดุฑุนุงู:</span> <span className="text-red-600 font-bold">ููุฑูููุฉ</span> ุชุฌุฑู ุจูู ุงูุฒูุฌูู ุนูู <span className="text-green-700 font-bold">ุนูุถ ูุงูู</span> ุชุฏูุนู ุงููุฑุฃุฉ ูุฒูุฌูุง.</p>
                    <div className="verse">๏ดฟููุฅููู ุฎูููุชููู ุฃููููุง ูููููููุง ุญูุฏููุฏู ุงูููููู ููููุง ุฌูููุงุญู ุนูููููููููุง ูููููุง ุงููุชูุฏูุชู ุจููู๏ดพ</div>
                </div>,
                acts: [
                    { q: 'ุงูุฎูุน ุดุฑุนุงู ููุน ุจููุงุจู:', opts: ['ุนูุถ ูุงูู', 'ุฅูุฑุงู ูู ุงููุงุถู', 'ุจุฏูู ููุงุจู', 'ุชูุงุฒู ุนู ุงูุญุถุงูุฉ'], ans: 0 },
                    { q: 'ุตุญ ุฃู ุฎุทุฃ: ุงูุฎูุน ูุฃุฎูุฐ ูุบุฉ ูู ุฎูุน ุงูุซูุจ.', opts: ['ุตุญ', 'ุฎุทุฃ'], ans: 0 }
                ]
            },
            {
                title: 'ุฃุญูุงู ุงูุฎูุน', bg: 'bg-blue-50',
                content: <div className="space-y-4 text-lg">
                    <ul className="list-disc list-inside space-y-2">
                        <li><span className="text-green-600 font-bold">ุฌุงุฆุฒ</span> ูุณูุก ุงูุนุดุฑุฉ ุจุนูุถ ูุงูู.</li>
                        <li><span className="text-red-600 font-bold">ูุง ููุน</span> ูู ุบูุฑ ุงูุฑุดูุฏุฉ ูููุต ุฃูููุชูุง.</li>
                        <li>ุฅุฐุง ุฎุงูุนูุง <span className="text-red-600 font-bold">ูุง ุฑุฌุนุฉ ูู ุนูููุง</span> ุฅูุง ุจุนูุฏ ูููุฑ ุฌุฏูุฏูู.</li>
                        <li><span className="text-green-600 font-bold">ูุฌูุฒ ุงูุฎูุน ูู ุงูุญูุถ</span> ูุนุฏู ุงูุถุฑุฑ ุจุชุทููู ุงูุนุฏุฉ.</li>
                    </ul>
                </div>,
                acts: [
                    { q: 'ูู ููุฒูุฌ ุฅุฑุฌุงุน ุงููุฎุชูุนุฉ ูู ุนุฏุชูุง ุจุฏูู ุนูุฏ ุฌุฏูุฏุ', opts: ['ูุนู ูุญู ูู', 'ูุงุ ุฅูุง ุจุนูุฏ ุฌุฏูุฏ', 'ูุนู ุจุฑุถุงูุง', 'ูุนู ุจุฅุฐู ุงููุงุถู'], ans: 1 },
                    { q: 'ุตุญ ุฃู ุฎุทุฃ: ูุญุฑู ุฅููุงุน ุงูุฎูุน ูู ูุชุฑุฉ ุงูุญูุถ.', opts: ['ุตุญ', 'ุฎุทุฃ'], ans: 1 }
                ]
            },
            {
                title: 'ุงูุทูุงู: ุญููู ููู ููุน ููู', bg: 'bg-rose-50',
                content: <div className="space-y-4 text-lg">
                    <p><span className="text-blue-700 font-bold">ุดุฑุนุงู:</span> ุญู ููุฏ ุงูููุงุญ ุฃู ุจุนุถู.</p>
                    <p>ููุน ุงูุทูุงู ูู ุงูุฒูุฌ <span className="text-green-600 font-bold">ุงูุจุงูุบ ุงูุนุงูู ุงููุฎุชุงุฑ</span>.</p>
                    <p className="p-3 bg-white rounded border-r-4 border-red-500">
                        ููุง ููุน ุทูุงู ูู ูู: <span className="text-red-600 font-bold">ุงูุตุจูุ ุงููุฌูููุ ุงูุณูุฑุงู ุบูุฑ ุงููููุฒุ ุงูููุฑูุ ูุงูุบุถุจุงู ุบุถุจุงู ุดุฏูุฏุงู ูุง ูุฏุฑู ูุง ูููู</span>.
                    </p>
                </div>,
                acts: [
                    { q: 'ุฑุฌู ุฃููุฑู ุชุญุช ุชูุฏูุฏ ุงูุณูุงุญ ููุทูู ุฒูุฌุชูุ ููุง ุงูุญููุ', opts: ['ููุน ุงูุทูุงู', 'ูุง ููุน ุงูุทูุงู', 'ููุน ุทููุฉ ุฑุฌุนูุฉ', 'ููุน ุฎูุนุงู'], ans: 1 }
                ]
            },
            {
                title: 'ุฃููุงุธ ุงูุทูุงู', bg: 'bg-amber-50',
                content: <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                    <div className="bg-white p-4 rounded border-t-4 border-green-500 shadow-sm">
                        <span className="font-bold text-green-700 text-xl">1. ุฃููุงุธ ุตุฑูุญุฉ:</span> 
                        <p className="mt-2 text-gray-600">ูุง ุชุญุชูู ุบูุฑ ุงูุทูุงู (ูุซู: ุฃูุช ุทุงูู).</p>
                        <p className="mt-2"><span className="text-red-600 font-bold">ุญููู:</span> ููุน ูุฅู ูู ูููู (ุญุชู ูู ูุงู ูุงุฒุญุงู).</p>
                    </div>
                    <div className="bg-white p-4 rounded border-t-4 border-amber-500 shadow-sm">
                        <span className="font-bold text-amber-700 text-xl">2. ุฃููุงุธ ููุงูุฉ:</span> 
                        <p className="mt-2 text-gray-600">ุชุญุชูู ุงูุทูุงู ูุบูุฑู (ูุซู: ุงูุญูู ุจุฃููู).</p>
                        <p className="mt-2"><span className="text-red-600 font-bold">ุญููู:</span> ูุง ููุน ุฅูุง ุจูุฌูุฏ ุงูููุฉ.</p>
                    </div>
                </div>,
                acts: [
                    { q: 'ูุงู ูุฒูุฌุชู ูุงุฒุญุงู ุจุฏูู ููุฉ: (ุฃูุช ุทุงูู)ุ ููู ููุนุ', opts: ['ูุง ููุน', 'ููุน ูุฃูู ููุธ ุตุฑูุญ', 'ููุน ุฅู ุบุถุจุช', 'ููุน ูุทููุฉ ุจุงุฆูุฉ'], ans: 1 },
                    { q: 'ููุธ (ุงูุญูู ุจุฃููู) ูุนุชุจุฑ ูู:', opts: ['ุงูุฃููุงุธ ุงูุตุฑูุญุฉ', 'ุฃููุงุธ ุงูููุงูุฉ', 'ุงูุฎูุน', 'ุงูุธูุงุฑ'], ans: 1 }
                ]
            },
            {
                title: 'ุทูุงู ุงูุณูุฉ ูุงูุจุฏุนุฉ', bg: 'bg-purple-50',
                content: <div className="space-y-4 text-lg">
                    <p className="bg-white p-3 border-r-4 border-green-500"><span className="text-green-700 font-bold">ุทูุงู ุงูุณูุฉ:</span> ุทููุฉ ูุงุญุฏุฉุ ูู ุทูุฑ ูู ูุฌุงูุนูุง ููู.</p>
                    <p className="bg-white p-3 border-r-4 border-red-500 mt-2"><span className="text-red-700 font-bold">ุงูุทูุงู ุงูุจุฏุนู:</span> ูุญุฑู ููุฃุซู ูุงุนูู (ููููู ููุน)ุ ููููู ุจู:</p>
                    <ul className="list-disc list-inside text-red-600 pr-4">
                        <li>ุฃู ูุทูููุง ูู ุงูุญูุถ.</li>
                        <li>ุฃู ูุทูููุง ูู ุทูุฑ ุฌุงูุนูุง ููู.</li>
                        <li>ุฃู ูุทูููุง ุซูุงุซุงู ุจููุธ ูุงุญุฏ (ุฃูุช ุทุงูู ุจุงูุซูุงุซ).</li>
                    </ul>
                </div>,
                acts: [
                    { q: 'ุชุทููู ุงูุฒูุฌุฉ ููู ุญุงุฆุถ ูุนุชุจุฑ ุทูุงูุงู:', opts: ['ุณููุงู', 'ุจุฏุนูุงู ูุญุฑูุงู ูููุน', 'ุจุฏุนูุงู ููุง ููุน', 'ูุจุงุญุงู'], ans: 1 },
                    { q: 'ุตุญ ุฃู ุฎุทุฃ: ุงูุทูุงู ุงูุจุฏุนู ูุฃุซู ูุงุนูู ููุง ููุน ุฃุจุฏุงู.', opts: ['ุตุญ', 'ุฎุทุฃ'], ans: 1 }
                ]
            },
            {
                title: 'ุงูุฑุฌุนุฉ ูุดุฑูุทูุง', bg: 'bg-teal-50',
                content: <div className="space-y-4 text-lg">
                    <p><span className="text-blue-700 font-bold">ุงูุฑุฌุนุฉ:</span> ุฅุนุงุฏุฉ ุฒูุฌุชู ุงููุทููุฉ ุทูุงูุงู ุบูุฑ ุจุงุฆู ุจุฏูู ุนูุฏ.</p>
                    <p className="font-bold text-navy">ุดุฑูุท ุตุญุฉ ุงูุฑุฌุนุฉ:</p>
                    <ul className="list-disc list-inside bg-white p-4 rounded shadow-sm">
                        <li>ุฃู ูููู ุงูุทูุงู <span className="text-green-600 font-bold">ุฏูู ุงูุซูุงุซ</span>.</li>
                        <li>ุฃู ุชููู ุงููุทููุฉ <span className="text-green-600 font-bold">ูุฏุฎููุงู ุจูุง</span>.</li>
                        <li>ุฃู ูููู ุงูุทูุงู <span className="text-green-600 font-bold">ุจุบูุฑ ุนูุถ</span>.</li>
                        <li>ุฃู ุชููู ุงูุฑุฌุนุฉ <span className="text-green-600 font-bold">ุฃุซูุงุก ุงูุนุฏุฉ</span>.</li>
                    </ul>
                </div>,
                acts: [
                    { q: 'ุทูู ุฒูุฌุชู ูุจู ุฃู ูุฏุฎู ุจูุงุ ูู ูุญู ูู ูุฑุงุฌุนุชูุงุ', opts: ['ูุนู', 'ูุงุ ูุฃูู ูุง ุนุฏุฉ ููุง', 'ูุนู ุฅุฐุง ุฑุถูุช', 'ูุนู ุจููุงููุฉ ุงูููู'], ans: 1 }
                ]
            }
        ];

        // --- 12 ุจุทุงูุฉ ---
        const FLASHCARDS = [
            { f: "ุงูุฎูุน ุดุฑุนุงู", b: "ูุฑูุฉ ุชุฌุฑู ุจูู ุงูุฒูุฌูู ุนูู ุนูุถ ูุงูู ุชุฏูุนู ุงููุฑุฃุฉ ูุฒูุฌูุง." },
            { f: "ุงูุทูุงู ุดุฑุนุงู", b: "ุญู ููุฏ ุงูููุงุญ ุฃู ุจุนุถู." },
            { f: "ุทูุงู ุตุฑูุญ", b: "ููุธ ูุง ูุญุชูู ุบูุฑ ุงูุทูุงู (ุฃูุช ุทุงูู)ุ ูููุน ูุฅู ูู ูููู." },
            { f: "ุทูุงู ููุงูุฉ", b: "ููุธ ูุญุชูู ุงูุทูุงู ูุบูุฑู (ุงูุญูู ุจุฃููู)ุ ููุง ููุน ุฅูุง ุจููุฉ." },
            { f: "ุทูุงู ุงูุณูุฉ", b: "ุทููุฉ ูุงุญุฏุฉ ูู ุทูุฑ ูู ูุฌุงูุนูุง ููู." },
            { f: "ุทูุงู ุงูุจุฏุนุฉ", b: "ุงูุทูุงู ูู ุงูุญูุถุ ุฃู ุจุนุฏ ุฌูุงุนุ ุฃู ุซูุงุซุงู ุจููุธ ูุงุญุฏ." },
            { f: "ุงูุฑุฌุนุฉ", b: "ุฅุนุงุฏุฉ ุงููุทููุฉ ุฑุฌุนูุงู ูุนุตูุชู ุจุฏูู ุนูุฏ." },
            { f: "ุทูุงู ุบูุฑ ุงููุฏุฎูู ุจูุง", b: "ุจุงุฆู ูุง ุนุฏุฉ ููุงุ ูุชุจูู ุจูุฌุฑุฏ ุงููุทู ุจุงูุทูุงู." },
            { f: "ุงูุฎูุน ูู ุงูุญูุถ", b: "ูุฌูุฒ ุดุฑุนุงู ููุง ููุฑูุ ูุนุฏู ุงูุถุฑุฑ ุจุชุทููู ุงูุนุฏุฉ." },
            { f: "ุทูุงู ุงูุบุถุจุงู", b: "ุงูุบุถุจุงู ุบุถุจุงู ุดุฏูุฏุงู ูููุฏู ุงูุฅุฏุฑุงู ูุง ููุน ุทูุงูู." },
            { f: "ุงูุจููููุฉ ุงูุตุบุฑู", b: "ุงููุถุงุก ุงูุนุฏุฉ ูุจู ุงูุฑุฌุนุฉุ ุชุญู ูู ุจุนูุฏ ูููุฑ ุฌุฏูุฏูู." },
            { f: "ุงูุจููููุฉ ุงููุจุฑู", b: "ุงุณุชููุงุก 3 ุทููุงุชุ ูุง ุชุญู ูู ุญุชู ุชุชุฒูุฌ ุบูุฑู ููุฏุฎู ุจูุง." }
        ];

        // --- 10 ุฃุณุฆูุฉ ููุงููุฉ ---
        const ESSAYS = [
            { q: "ูุง ูู ุงูุฎูุน ุดุฑุนุงูุ ููุง ุฏูููู ูู ุงููุฑุขู ุงููุฑููุ", a: "ูู ูุฑูุฉ ุชุฌุฑู ุจูู ุงูุฒูุฌูู ุนูู ุนูุถ ูุงูู ุชุฏูุนู ุงููุฑุฃุฉ. ุฏูููู: ๏ดฟููุฅููู ุฎูููุชููู ุฃููููุง ูููููููุง ุญูุฏููุฏู ุงูููููู ููููุง ุฌูููุงุญู ุนูููููููููุง ูููููุง ุงููุชูุฏูุชู ุจููู๏ดพ." },
            { q: "ูุง ูู ุงูุญููุฉ ูู ูุดุฑูุนูุฉ ุงูุฎูุนุ", a: "ุฏูุน ุงูุถุฑุฑ ุนู ุงููุฑุฃุฉ ุฅุฐุง ุณุงุกุช ุงูุนุดุฑุฉ ููุฑูุช ุฎูู ุฒูุฌูุง ุฃู ุฏูููุ ูุฎุงูุช ุฃูุง ุชููู ุญุฏูุฏ ุงูููุ ููุจุงุญ ููุง ุทูุจ ุงููุฑุงู ููุงุจู ุนูุถ." },
            { q: "ูู ููุน ุงูุทูุงู ูู ุงูููุฑูุ ููุง ุงูุนูุฉุ", a: "ูุง ููุน ุทูุงู ุงูููุฑูุ ูุนุฏู ูุฌูุฏ ุงููุตุฏ ูุงูุฑุถุง ูุงูุงุฎุชูุงุฑ ุงูุฐู ูู ุดุฑุท ูู ุตุญุฉ ุฅููุงุน ุงูุทูุงู." },
            { q: "ูุง ุงููุฑู ุจูู ุงูุทูุงู ุงูุตุฑูุญ ูุงูููุงูุฉุ", a: "ุงูุตุฑูุญ: ููุถูุน ููุทูุงู (ุทููุชู) ูููุน ุจูุง ููุฉ ุจูุฌุฑุฏ ุงูุชููุธ ุจู. ุงูููุงูุฉ: ูุญุชูู ุงูุทูุงู (ุงุฎุฑุฌู) ููุง ููุน ุฅูุง ุจูุฌูุฏ ููุฉ ุงูุทูุงู." },
            { q: "ูุง ุญูู ุฅููุงุน ุงูุทูุงู ุงูุจุฏุนูุ ููู ููุนุ", a: "ุญููู ูุญุฑู ููุฃุซู ุงูุฒูุฌ ุจูุนููุ ููููู ููุน ุดุฑุนุงู ูุชูุญุณุจ ุทููุฉ (ูููุงู ููุฌูููุฑ)." },
            { q: "ูุง ูู ุดุฑูุท ุตุญุฉ ุงูุฑุฌุนุฉุ", a: "1- ุฃู ูููู ุงูุทูุงู ุฏูู ุงูุซูุงุซ. 2- ุฃู ุชููู ูุฏุฎููุงู ุจูุง. 3- ุฃู ูููู ุงูุทูุงู ุจูุง ุนูุถ. 4- ุฃู ุชููู ุงูุฑุฌุนุฉ ุฃุซูุงุก ุงูุนุฏุฉ." },
            { q: "ูู ูุดุชุฑุท ูุฑุฌุนุฉ ุงููุฑุฃุฉ ุฑุถุงูุง ุฃู ูุฌูุฏ ููููุงุ", a: "ูุง ูุดุชุฑุท ุฑุถุงูุง ููุง ุฑุถุง ููููุงุ ูุงูุฒูุฌ ุฃุญู ุจุฑุฏูุง ูู ุงูุนุฏุฉ ููููู ุชุนุงูู: (ูุจุนููุชูู ุฃุญู ุจุฑุฏูู)." },
            { q: "ุจู ุชุญุตู ุงูุฑุฌุนุฉ ูููุทููุฉุ", a: "ุชุญุตู ุจุงูููุธ ูุซู (ุฑุงุฌุนุช ุงูุฑุฃุชู)ุ ุฃู ุชุญุตู ุจุงููุนู ูุงููุทุก ุฅุฐุง ููู ุจู ุงูุฑุฌุนุฉ." },
            { q: "ูุง ุงููุฑู ุจูู ุงูุจููููุฉ ุงูุตุบุฑู ูุงููุจุฑูุ", a: "ุงูุตุบุฑู: ุงููุถุงุก ุงูุนุฏุฉ ูุชุญู ุจุนูุฏ ูููุฑ ุฌุฏูุฏูู. ุงููุจุฑู: ุงุณุชููุงุก 3 ุทููุงุชุ ููุง ุชุญู ูู ุญุชู ุชุชุฒูุฌ ุฑุฌูุงู ุบูุฑู ูููุงุฑููุง." },
            { q: "ูุง ุญูู ุฎุฑูุฌ ุงููุทููุฉ ุฑุฌุนูุงู ูู ุจูุชูุง ุฃุซูุงุก ุงูุนุฏุฉุ", a: "ุชุนุชุจุฑ ุฒูุฌุฉุ ููุง ูุฌูุฒ ููุง ุงูุฎุฑูุฌ ููุง ููุฒูุฌ ุฅุฎุฑุงุฌูุงุ ูููุง ุญู ุงููููุฉ ูุงูุณููู." }
        ];

        // --- 20 ุณุคุงู ุงุฎุชูุงุฑู ---
        const QUIZ = [
            { q: "ุงูุฎูุน ูุบุฉ ูุฃุฎูุฐ ูู:", o: ["ุฎูุน ุงูุซูุจ", "ุงูุฎุฑูุฌ ูุงููุฑูุจ", "ุงูุชุฑู ูุงููุฌุฑ", "ุงููุณูุฉ"], a: 0 },
            { q: "ุงูุฎูุน ุดุฑุนุงู ููุน ููุงุจู:", o: ["ุจุฏูู ููุงุจู", "ุนูุถ ูุงูู", "ุดุฑูุท ูุงุณูุฉ", "ุชูุงุฒู ุนู ุงูุญุถุงูุฉ"], a: 1 },
            { q: "ุญูู ุงูุฎูุน ูุณูุก ุงูุนุดุฑุฉ:", o: ["ูุญุฑู", "ููุฑูู", "ุฌุงุฆุฒ", "ูุงุฌุจ"], a: 2 },
            { q: "ุงูุฎูุน ูู ุงููุฑุฃุฉ ุบูุฑ ุงูุฑุดูุฏุฉ:", o: ["ููุน ูุงูุฐุงู", "ูุง ููุน ูููุต ุฃูููุชูุง", "ููุน ุจุดุฑูุท", "ููููู"], a: 1 },
            { q: "ูู ููุฒูุฌ ุฅุฑุฌุงุน ุงููุฎุชูุนุฉ ูู ุนุฏุชูุงุ", o: ["ูุนู ูุญู ูู", "ูุงุ ุฅูุง ุจุนูุฏ ูููุฑ ุฌุฏูุฏูู", "ูุนู ุจุฑุถุงูุง", "ูุนู ุจุญูู ุงููุงุถู"], a: 1 },
            { q: "ุฅููุงุน ุงูุฎูุน ูู ูุชุฑุฉ ุงูุญูุถ ูุนุชุจุฑ:", o: ["ูุญุฑูุงู", "ููุฑููุงู", "ุฌุงุฆุฒุงู ูุนุฏู ุงูุถุฑุฑ", "ุจุงุทูุงู"], a: 2 },
            { q: "ุงูุทูุงู ูุบุฉ ูุนูู:", o: ["ุงูุชุฎููุฉ", "ุงูุฑุจุท", "ุงูุฌูุน", "ุงููุณูุฉ"], a: 0 },
            { q: "ููุน ุงูุทูุงู ุตุญูุญุงู ูู:", o: ["ุงูุตุจู ุงููููุฒ", "ุงููุฌููู", "ุงูุจุงูุบ ุงูุนุงูู ุงููุฎุชุงุฑ", "ุงูููุฑู"], a: 2 },
            { q: "ุทูุงู ุงูุบุถุจุงู ุบุถุจุงู ุดุฏูุฏุงู ูุง ูุฏุฑู ูุง ูููู:", o: ["ููุน ุฑุฌุนูุงู", "ููุน ุจุงุฆูุงู", "ูุง ููุน ุงูุทูุงู", "ููุน ุจุดุฑูุท"], a: 2 },
            { q: "ููุธ (ุฃูุช ุทุงูู) ูุนุชุจุฑ:", o: ["ุฃููุงุธ ููุงูุฉ", "ุฃููุงุธ ุตุฑูุญุฉ", "ุฎูุนุงู", "ุธูุงุฑุงู"], a: 1 },
            { q: "ุฃููุงุธ ุงูููุงูุฉ ูุซู (ุงูุญูู ุจุฃููู):", o: ["ุชูุน ุจูุง ููุฉ", "ูุง ุชูุน ุฅูุง ุจูุฌูุฏ ููุฉ", "ูุง ุชูุน ุฃุจุฏุงู", "ุชูุน ูู ุญุงู ุงูุบุถุจ ููุท"], a: 1 },
            { q: "ุทูุงู ุงูุณูุฉ ูู ุฃู ูุทูููุง ุทููุฉ ูุงุญุฏุฉ ูู:", o: ["ูุชุฑุฉ ุงูุญูุถ", "ุทูุฑ ุฌุงูุนูุง ููู", "ุทูุฑ ูู ูุฌุงูุนูุง ููู", "ูุชุฑุฉ ุงูููุงุณ"], a: 2 },
            { q: "ูุง ุญูู ุฅููุงุน ุงูุทูุงู ุงูุจุฏุนูุ", o: ["ูุจุงุญ", "ูุณุชุญุจ", "ูุญุฑู ููุฃุซู ูุงุนูู", "ููุฑูู ุชูุฒููุงู"], a: 2 },
            { q: "ุงูุทูุงู ุซูุงุซุงู ุจููุธ ูุงุญุฏ (ุฃูุช ุทุงูู ุจุงูุซูุงุซ) ูุนุชุจุฑ:", o: ["ุทูุงู ุณูุฉ", "ุทูุงู ุจุฏุนู ูุญุฑู", "ุทูุงูุงู ูุณุชุญุจุงู", "ูุง ููุน ูุทููุงู"], a: 1 },
            { q: "ุงูุฑุฌุนุฉ ุดุฑุนุงู ุชุนูู ุฅุนุงุฏุฉ ุงููุทููุฉ:", o: ["ุงูุจุงุฆู", "ุบูุฑ ุงูุจุงุฆู (ุงูุฑุฌุนูุฉ)", "ูุจู ุงูุฏุฎูู", "ุงููุฎุชูุนุฉ"], a: 1 },
            { q: "ูู ุดุฑูุท ุงูุฑุฌุนุฉ ุฃู ูููู ุงูุทูุงู:", o: ["ุฏูู ุงูุซูุงุซ", "ุงูุทููุฉ ุงูุซุงูุซุฉ", "ุจููุงุจู ูุงูู (ุฎูุน)", "ูุจู ุงูุฏุฎูู"], a: 0 },
            { q: "ุฑุถุง ุงูุฒูุฌุฉ ูู ุงูุฑุฌุนุฉ ุฃุซูุงุก ุงูุนุฏุฉ:", o: ["ุดุฑุท ุฃุณุงุณู", "ุฑูู ูู ุงูุฃุฑูุงู", "ูุง ูุดุชุฑุท", "ูุณุชุญุจ"], a: 2 },
            { q: "ุงููุทููุฉ ุฑุฌุนูุงู ููู ูู ูุชุฑุฉ ุงูุนุฏุฉ:", o: ["ุชุฎุฑุฌ ูุจูุช ุฃูููุง", "ุชุนุชุจุฑ ุฒูุฌุฉ ูููุง ุงููููุฉ ูุงูุณูู", "ูุง ูููุฉ ููุง", "ุชุจูู ููุฑุงู"], a: 1 },
            { q: "ุงูุจููููุฉ ุงูุตุบุฑู ุชุนูู ุฃู ุงููุฑุฃุฉ:", o: ["ุชุนูุฏ ุจูุง ุนูุฏ", "ูุง ุชุญู ูู ุฃุจุฏุงู", "ุชุญู ูู ุจุนูุฏ ูููุฑ ุฌุฏูุฏูู", "ุชุณุชุฃูู ุงูุนุฏุฉ"], a: 2 },
            { q: "ุงูุจููููุฉ ุงููุจุฑู ุชุนูู ุฃู ุงููุฑุฃุฉ:", o: ["ุชุญู ุจุนูุฏ ุฌุฏูุฏ", "ูุง ุชุญู ูู ุญุชู ุชุชุฒูุฌ ุบูุฑู ูููุงุฑููุง", "ุชุญู ุจุนุฏ ุณูุฉ ูุงููุฉ", "ุชุญู ุจุงูุชุฑุงุถู ูุงููุญุจุฉ"], a: 1 }
        ];

        // ==========================================
        // 2. DB & UTILS
        // ==========================================
        const DB_KEY = 'fiqh_v5';
        const getRecs = () => JSON.parse(localStorage.getItem(DB_KEY) || '[]');
        const saveRec = (r) => { const x = getRecs(); x.push(r); localStorage.setItem(DB_KEY, JSON.stringify(x)); };
        const getConf = (k) => localStorage.getItem(k) || '';
        const saveConf = (k, v) => localStorage.setItem(k, v);

        // ==========================================
        // 3. COMPONENTS
        // ==========================================
        const Dash = ({ onClose }) => {
            const [url, setUrl] = React.useState(getConf('gsURL'));
            const [api, setApi] = React.useState(getConf('geminiAPI'));
            const recs = getRecs().sort((a,b)=> b.ts - a.ts);
            
            return (
                <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
                    <div className="bg-navy w-full max-w-3xl rounded-xl p-6 text-white animate-fade max-h-[90vh] overflow-y-auto border border-gold">
                        <div className="flex justify-between border-b border-gray-600 pb-3 mb-6">
                            <h2 className="text-2xl text-gold font-amiri">ููุญุฉ ุงูุฃุณุชุงุฐ ุฏ. ุจุงุณู ุงููุฑุงูู</h2>
                            <button onClick={onClose} className="text-red-400 font-bold hover:text-red-300">ุฅุบูุงู โ</button>
                        </div>
                        <div className="space-y-4 mb-8 bg-white/5 p-4 rounded-lg">
                            <div>
                                <label className="block text-gold mb-1 text-sm">ููุชุงุญ Google Gemini API:</label>
                                <input type="password" value={api} onChange={e=>setApi(e.target.value)} placeholder="AIzaSy..." className="w-full p-2 bg-black/50 border border-gray-600 rounded text-left dir-ltr outline-none focus:border-gold"/>
                            </div>
                            <div>
                                <label className="block text-gold mb-1 text-sm">ุฑุงุจุท Google Sheets Web App:</label>
                                <input value={url} onChange={e=>setUrl(e.target.value)} placeholder="https://script.google.com/macros/..." className="w-full p-2 bg-black/50 border border-gray-600 rounded text-left dir-ltr outline-none focus:border-gold"/>
                            </div>
                            <button onClick={() => {saveConf('gsURL',url); saveConf('geminiAPI',api); alert('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ.');}} className="bg-gold text-navy px-6 py-2 rounded font-bold hover:bg-yellow-500 transition">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                        </div>
                        
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-gold text-xl">ูุชุงุฆุฌ ุงูุทูุงุจ ({recs.length})</h3>
                        </div>
                        <div className="bg-black/30 rounded border border-gray-700 overflow-x-auto">
                            <table className="w-full text-sm text-right">
                                <thead className="bg-black/50">
                                    <tr className="text-gold border-b border-gray-600"><th className="p-3">ุงูุงุณู</th><th className="p-3">ุงูุดุนุจุฉ</th><th className="p-3">ุงูุฏุฑุฌุฉ</th><th className="p-3">ุงูุชุงุฑูุฎ</th></tr>
                                </thead>
                                <tbody>
                                    {recs.map((r,i)=><tr key={i} className="border-b border-gray-700/50 hover:bg-white/5"><td className="p-3">{r.name}</td><td className="p-3">{r.sec}</td><td className="p-3 font-bold">{r.score}/20</td><td className="p-3 text-xs opacity-70">{r.date}</td></tr>)}
                                    {recs.length===0 && <tr><td colSpan="4" className="text-center p-6 text-gray-500">ูุง ููุฌุฏ ุทูุงุจ ูุณุฌููู ุจุนุฏ.</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [screen, setScreen] = React.useState('welcome');
            const [stu, setStu] = React.useState({ n: '', s: '' });
            const [dash, setDash] = React.useState(false);

            const [chatOpen, setChatOpen] = React.useState(false);
            const [msgs, setMsgs] = React.useState([{r:'bot', t:'ูุฑุญุจุงู ุจู! ุฃูุง ูุณุงุนุฏู ุงูุฐูู ููุงุฏุฉ ุงูููู. ูู ูุฏูู ุณุคุงู ุญูู ุงูููุงุญ ุฃู ุงูุทูุงูุ'}]);
            const [inp, setInp] = React.useState('');
            const [loadingChat, setLoadingChat] = React.useState(false);
            const endRef = React.useRef(null);

            const sendMsg = async () => {
                if(!inp.trim() || loadingChat) return;
                const txt = inp; setInp(''); 
                setMsgs(p => [...p, {r:'user', t:txt}]);
                setLoadingChat(true);
                
                try {
                    const key = getConf('geminiAPI'); 
                    if(!key) throw new Error("ุงููุนูู ูู ููู ุจุฅุถุงูุฉ ููุชุงุญ ุงูุฐูุงุก ุงูุงุตุทูุงุนู.");
                    
                    // ุงูุชุญุฏูุซ ุงูุฌุฐุฑู ููุง: ุงุณุชุฎุฏุงู gemini-1.5-flash ููู ุงููุฏุนูู ุฑุณููุงู ุงูุขู ูู ุฌูุฌู ููู REST API
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: `ุฃูุช ูุนูู ููู ููุณุฑ ูุทูุงุจ ุงูุฌุงูุนุฉ ุชุดุฑุญ ุฃุญูุงู ุงูุทูุงู ูุงูุฎูุน. ุฃุฌุจ ุจุงุฎุชุตุงุฑ ููุทู.\nุณุคุงู ุงูุทุงูุจ: ${txt}` }] }] })
                    });
                    
                    const d = await res.json();
                    if(!res.ok) throw new Error(d.error?.message || "ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู");
                    
                    setMsgs(p => [...p, {r:'bot', t: d.candidates[0].content.parts[0].text}]);
                } catch(e) { 
                    setMsgs(p => [...p, {r:'bot', t: "โ๏ธ " + e.message}]); 
                }
                setLoadingChat(false);
            };

            React.useEffect(() => { endRef.current?.scrollIntoView({ behavior: "smooth" }); }, [msgs, loadingChat]);

            return (
                <div className="min-h-screen pb-20">
                    {screen !== 'welcome' && (
                        <header className="bg-navy text-white p-3 sticky top-0 z-40 flex justify-between items-center shadow-md border-b-[3px] border-gold">
                            <div className="flex flex-col">
                                <span className="text-gold font-amiri text-lg font-bold">ุงูููู ุงูููุณุฑ</span>
                                <span className="text-xs text-gray-300">ุฅุดุฑุงู: ุฏ. ุจุงุณู ุงููุฑุงูู</span>
                            </div>
                            <div className="text-left text-sm font-bold bg-white/10 px-3 py-1.5 rounded-lg border border-white/20">{stu.n} | {stu.s}</div>
                        </header>
                    )}

                    <main className="max-w-3xl mx-auto mt-6 px-4">
                        {screen === 'welcome' && (
                            <div className="animate-fade flex flex-col items-center justify-center min-h-[85vh]">
                                <img src="../../logo.png" alt="ุดุนุงุฑ ุงูุฌุงูุนุฉ" className="h-28 mb-6 object-contain drop-shadow-md" onError={(e)=>e.target.style.display='none'}/>
                                <div className="bg-white p-8 rounded-3xl shadow-[0_10px_40px_-10px_rgba(22,33,62,0.1)] w-full max-w-sm text-center border-t-[6px] border-navy">
                                    <h1 className="text-4xl font-amiri text-navy mb-1 font-bold">ุงูููู ุงูููุณุฑ</h1>
                                    <h2 className="text-sm text-gray-500 mb-8 font-bold">ุฅุดุฑุงู: ุฏ. ุจุงุณู ุงููุฑุงูู</h2>
                                    
                                    <div className="space-y-4 mb-8">
                                        <input value={stu.n} onChange={e=>setStu({n:e.target.value,s:stu.s})} placeholder="ุงูุงุณู ุงูุซูุงุซู ููุทุงูุจ" className="w-full p-4 border-2 border-gray-100 rounded-xl focus:border-gold outline-none text-center bg-gray-50 focus:bg-white transition" />
                                        <input value={stu.s} onChange={e=>setStu({n:stu.n,s:e.target.value})} placeholder="ุฑูู ุงูุดุนุจุฉ" className="w-full p-4 border-2 border-gray-100 rounded-xl focus:border-gold outline-none text-center bg-gray-50 focus:bg-white transition" />
                                    </div>
                                    <button onClick={()=>{if(stu.n&&stu.s) setScreen('learn'); else alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุงุณู ูุงูุดุนุจุฉ ููุจุฏุก.');}} className="w-full bg-navy text-gold py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 transition shadow-lg shadow-navy/20">ุงุจุฏุฃ ุงูุชุนูู</button>
                                </div>
                                <button onClick={()=>{if(prompt('ุฃุฏุฎู ุฑูุฒ ุฏุฎูู ุงูุฃุณุชุงุฐ:')==='1234') setDash(true);}} className="mt-8 text-xs text-gray-400 hover:text-navy transition">ุฏุฎูู ููุญุฉ ุชุญูู ุงููุนูู</button>
                            </div>
                        )}

                        {screen === 'learn' && <Stepper />}
                        {screen === 'map' && <MindMap />}
                        {screen === 'review' && <Review />}
                        {screen === 'nawazil' && <Nawazil />}
                        {screen === 'quiz' && <Quiz stu={stu} />}
                    </main>

                    {screen !== 'welcome' && screen !== 'quiz' && (
                        <nav className="fixed bottom-0 w-full bg-white border-t-2 border-gray-100 z-40 flex justify-around p-2 text-sm shadow-[0_-10px_20px_rgba(0,0,0,0.02)]">
                            <button onClick={()=>setScreen('learn')} className={`p-2 flex-1 rounded-lg font-bold transition-colors ${screen==='learn'?'bg-gold text-navy':'text-gray-500 hover:bg-gray-50'}`}>ุงูุฏุฑุณ</button>
                            <button onClick={()=>setScreen('map')} className={`p-2 flex-1 rounded-lg font-bold transition-colors ${screen==='map'?'bg-gold text-navy':'text-gray-500 hover:bg-gray-50'}`}>ุงูุฎุฑุงุฆุท</button>
                            <button onClick={()=>setScreen('review')} className={`p-2 flex-1 rounded-lg font-bold transition-colors ${screen==='review'?'bg-gold text-navy':'text-gray-500 hover:bg-gray-50'}`}>ุงููุฑุงุฌุนุฉ</button>
                            <button onClick={()=>setScreen('nawazil')} className={`p-2 flex-1 rounded-lg font-bold transition-colors ${screen==='nawazil'?'bg-gold text-navy':'text-gray-500 hover:bg-gray-50'}`}>ุงูููุงุฒู</button>
                            <button onClick={()=>setScreen('quiz')} className={`p-2 flex-1 rounded-lg font-bold transition-colors ${screen==='quiz'?'bg-navy text-gold':'text-gray-500 hover:bg-gray-50'}`}>ุงูุงุฎุชุจุงุฑ</button>
                        </nav>
                    )}

                    {screen !== 'welcome' && (
                        <div className="fixed bottom-20 left-4 z-50">
                            {!chatOpen && <button onClick={()=>setChatOpen(true)} className="w-14 h-14 bg-gradient-to-tr from-navy to-blue-800 text-gold rounded-full shadow-2xl flex items-center justify-center font-bold text-2xl hover:scale-110 transition border-2 border-gold">ุ</button>}
                            {chatOpen && (
                                <div className="w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col h-96 animate-fade">
                                    <div className="bg-navy text-gold p-3 flex justify-between items-center text-sm border-b-2 border-gold">
                                        <span className="font-bold font-amiri text-lg">ุงููุณุงุนุฏ ุงููููู</span>
                                        <button onClick={()=>setChatOpen(false)} className="text-white hover:text-red-300 text-lg">โ</button>
                                    </div>
                                    <div className="flex-1 p-4 overflow-y-auto space-y-3 bg-[#faf8f3] text-sm">
                                        {msgs.map((m,i) => <div key={i} className={`p-3 rounded-xl shadow-sm leading-relaxed ${m.r==='bot'?'bg-white border border-gray-200 ml-8 text-navy':'bg-navy text-white mr-8 text-right'}`}>{m.t}</div>)}
                                        {loadingChat && <div className="text-xs text-gray-400 p-2 text-center animate-pulse">ูุชู ูุชุงุจุฉ ุงูุฅุฌุงุจุฉ...</div>}
                                        <div ref={endRef}/>
                                    </div>
                                    <div className="p-3 bg-white border-t flex gap-2">
                                        <input value={inp} onChange={e=>setInp(e.target.value)} onKeyDown={e=>e.key==='Enter'&&sendMsg()} placeholder="ุงูุชุจ ุณุคุงูู ุงููููู..." className="flex-1 border-2 border-gray-100 p-2 text-sm rounded-lg outline-none focus:border-gold transition"/>
                                        <button onClick={sendMsg} disabled={loadingChat} className="bg-gold text-navy px-4 rounded-lg font-bold hover:bg-yellow-500 disabled:opacity-50">ุฅุฑุณุงู</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {dash && <Dash onClose={()=>setDash(false)} />}
                </div>
            );
        };

        const Stepper = () => {
            const [step, setStep] = React.useState(0);
            const [actIdx, setActIdx] = React.useState(0);
            const t = TOPICS_DATA[step];

            const handleAns = (i) => {
                if(i === t.acts[actIdx].ans) {
                    if(actIdx < t.acts.length - 1) { 
                        alert('โ ุฅุฌุงุจุฉ ุตุญูุญุฉ! ููุชูู ููุณุคุงู ุงูุชุงูู.'); 
                        setActIdx(a=>a+1); 
                    } else { 
                        alert('๐ ุฃุญุณูุช! ุฃูููุช ุชูุงุฑูู ูุฐู ุงูุดุฑูุญุฉุ ููููู ุงูุงูุชูุงู ููุดุฑูุญุฉ ุงูุชุงููุฉ.'); 
                        setActIdx(-1); 
                    }
                } else alert('โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉุ ุญุงูู ูุฑุฉ ุฃุฎุฑู ููุชูุฏู.');
            };

            return (
                <div className="animate-fade pb-6">
                    <div className="flex gap-1.5 mb-6">
                        {TOPICS_DATA.map((_, i) => <div key={i} className={`h-2 flex-1 rounded-full ${i<=step?'bg-gold':'bg-gray-200'}`}></div>)}
                    </div>
                    
                    <div className={`${t.bg} p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100 mb-6`}>
                        <h2 className="text-2xl md:text-3xl font-amiri text-navy border-b-2 border-gold inline-block pb-2 mb-6 font-bold">{t.title}</h2>
                        {t.content}
                    </div>
                    
                    <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                        <h3 className="font-bold text-navy mb-4 text-xl flex items-center gap-2">๐ฏ ุงุฎุชุจุฑ ูููู ูุจู ุงูุงูุชูุงู:</h3>
                        {actIdx !== -1 ? (
                            <div className="animate-fade">
                                <p className="mb-4 text-gray-800 font-bold text-lg">{t.acts[actIdx].q}</p>
                                <div className="space-y-3">
                                    {t.acts[actIdx].opts.map((opt, i) => (
                                        <button key={i} onClick={()=>handleAns(i)} className="w-full text-right p-4 bg-gray-50 border-2 border-gray-100 rounded-xl hover:border-gold hover:bg-gold/10 transition font-medium text-navy text-lg">{opt}</button>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="text-center bg-green-50 border border-green-200 text-green-700 font-bold p-6 rounded-xl animate-fade text-lg">
                                โ ุฃูููุช ุชูุงุฑูู ูุฐู ุงูุดุฑูุญุฉ ุจูุฌุงุญ! ุงุถุบุท (ุงูุชุงูู).
                            </div>
                        )}
                    </div>
                    
                    <div className="flex justify-between mt-8">
                        <button disabled={step===0} onClick={()=>{setStep(s=>s-1); setActIdx(-1);}} className="px-8 py-3 bg-gray-200 text-gray-600 font-bold rounded-xl disabled:opacity-50 hover:bg-gray-300 transition">ุงูุณุงุจู</button>
                        <button disabled={actIdx !== -1} onClick={()=>{if(step<TOPICS_DATA.length-1){setStep(s=>s+1); setActIdx(0);}}} className="px-8 py-3 bg-navy text-gold font-bold rounded-xl disabled:opacity-50 hover:bg-opacity-90 transition shadow-lg">ุงูุชุงูู</button>
                    </div>
                </div>
            );
        };

        const MindMap = () => (
            <div className="animate-fade flex flex-col gap-10 pb-10 items-center overflow-x-auto pt-4">
                <div className="w-full max-w-2xl bg-white p-8 rounded-3xl shadow-sm border text-center">
                    <div className="map-root">ุงููุฑูุฉ ุจูู ุงูุฒูุฌูู</div>
                    <div className="flex justify-around relative pt-6 border-t-2 border-gold/50">
                        <div className="map-branch w-[45%] shadow-sm">
                            <h3 className="font-bold text-navy text-xl border-b pb-2 mb-2">ุงูุฎูุน</h3>
                            <p className="text-sm text-gray-600 font-medium">ุจุนูุถ ูุงูู<br/>ุจุงุฆูุฉ ูุง ุฑุฌุนุฉ ูููุง<br/>ูุฌูุฒ ูู ุงูุญูุถ</p>
                        </div>
                        <div className="map-branch w-[45%] shadow-sm">
                            <h3 className="font-bold text-navy text-xl border-b pb-2 mb-2">ุงูุทูุงู</h3>
                            <p className="text-sm text-gray-600 font-medium">ุจุบูุฑ ุนูุถ<br/>ุฑุฌุนู ุฃู ุจุงุฆู<br/>ูุง ูุฌูุฒ ูู ุงูุญูุถ</p>
                        </div>
                    </div>
                </div>
                
                <div className="w-full max-w-2xl bg-white p-8 rounded-3xl shadow-sm border text-center">
                    <div className="map-root">ุฃูุณุงู ุงูุทูุงู</div>
                    <div className="flex justify-around relative pt-6 border-t-2 border-gold/50">
                        <div className="map-branch w-[30%] shadow-sm">
                            <h3 className="font-bold text-green-700 text-lg border-b pb-2 mb-2">ุณูู</h3>
                            <p className="text-xs text-gray-600 font-medium">ุทููุฉ ูุงุญุฏุฉุ ูู ุทูุฑ ูู ูุฌุงูุนูุง ููู</p>
                        </div>
                        <div className="map-branch w-[30%] shadow-sm">
                            <h3 className="font-bold text-red-700 text-lg border-b pb-2 mb-2">ุจุฏุนู</h3>
                            <p className="text-xs text-gray-600 font-medium">ูู ุงูุญูุถุ ุฃู ุทูุฑ ุฌุงูุน ูููุ ุฃู ุซูุงุซ ุจููุธ ูุงุญุฏ</p>
                        </div>
                        <div className="map-branch w-[30%] shadow-sm">
                            <h3 className="font-bold text-navy text-lg border-b pb-2 mb-2">ูู ุญูุซ ุงูููุธ</h3>
                            <p className="text-xs text-gray-600 font-medium">ุตุฑูุญ: (ุฃูุช ุทุงูู) ูุง ูุญุชุงุฌ ููุฉ.<br/>ููุงูุฉ: ูุญุชุงุฌ ููุฉ.</p>
                        </div>
                    </div>
                </div>
            </div>
        );

        const Review = () => {
            const [openQ, setOpenQ] = React.useState(null);
            
            return (
                <div className="animate-fade pb-10">
                    <h2 className="text-2xl font-amiri text-navy mb-6 text-center font-bold">1. ุจุทุงูุงุช ุงูููุงููู ({FLASHCARDS.length})</h2>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-12">
                        {FLASHCARDS.map((c, i) => {
                            const [fl, setFl] = React.useState(false);
                            return (
                                <div key={i} className={`flip-card ${fl?'flipped':''}`} onClick={()=>setFl(!fl)}>
                                    <div className="flip-card-inner">
                                        <div className="flip-card-front">{c.f}</div>
                                        <div className="flip-card-back">{c.b}</div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    <div className="border-t-2 border-gray-200 pt-8">
                        <h2 className="text-2xl font-amiri text-navy mb-6 text-center font-bold">2. ุงูุฃุณุฆูุฉ ุงูููุงููุฉ ููุชูููู ุงูุฐุงุชู ({ESSAYS.length})</h2>
                        <div className="space-y-4">
                            {ESSAYS.map((q, i) => (
                                <div key={i} className="rounded-xl overflow-hidden shadow-sm border border-gray-100">
                                    <button 
                                        onClick={()=>setOpenQ(openQ===i?null:i)} 
                                        className={`w-full text-right p-5 font-bold flex justify-between items-center transition-colors text-lg ${i%2===0 ? 'bg-navy text-white' : 'bg-gold text-navy'}`}>
                                        <span>{q.q}</span>
                                        <span className="text-2xl leading-none">{openQ===i?'โ':'+'}</span>
                                    </button>
                                    {openQ === i && <div className="p-6 bg-white text-gray-700 leading-relaxed border-x border-b border-gray-200 text-lg">{q.a}</div>}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Nawazil = () => {
            const [sc, setSc] = React.useState(''); 
            const [ans, setAns] = React.useState('');
            const [fb, setFb] = React.useState(''); 
            const [load, setLoad] = React.useState(false);

            const callGemini = async (sys, prompt) => {
                const key = getConf('geminiAPI'); 
                if(!key) throw new Error("ููุชุงุญ API ุบูุฑ ูุชููุฑุ ุงูุฑุฌุงุก ุฅุฎุจุงุฑ ุงููุนูู ูุฅุถุงูุชู ูู ููุญุฉ ุงูุชุญูู.");
                // ุงูุชุญุฏูุซ ุงูุฌุฐุฑู ููุง ูุญู ุงููุดููุฉ:
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: `${sys}\n\n${prompt}` }] }] })
                });
                const d = await res.json(); 
                if(!res.ok) throw new Error(d.error?.message);
                return d.candidates[0].content.parts[0].text;
            };

            const gen = async () => { 
                setLoad(true); setFb(''); setAns(''); 
                try { 
                    setSc(await callGemini('ุฃูุช ุตุงูุน ููุงุฒู ููููุฉ ุฃุณุชุงุฐ ุฌุงูุนู.', 'ุงูุชุจ ูุตุฉ ูู ุณุทุฑูู ูุงูุนูุฉ ุฌุฏุงู ุชูุซู ูุงุฒูุฉ ููููุฉ ูู ุงูุทูุงู ุฃู ุงูุฎูุน ุฃู ุงูุฑุฌุนุฉุ ุชูุชูู ุจุณุคุงู: ูุง ุงูุญูู ุงููููู ูุน ุงูุชุนูููุ')); 
                } catch(e) { alert(e.message); } 
                setLoad(false); 
            };
            
            const evalAns = async () => { 
                setLoad(true); 
                try { 
                    setFb(await callGemini('ุฃูุช ูุตุญุญ ูููู ุตุงุฑู ููุทูู.', `ุงููุงุฒูุฉ ุงูุชู ุทุฑุญุช: ${sc}\nุฅุฌุงุจุฉ ุงูุทุงูุจ: ${ans}\nูู ุจุชุตุญูุญ ุงูุฅุฌุงุจุฉ ุจูุงุก ุนูู ุฃุญูุงู ุงูููู ุงูููุณุฑ ุจูุทู ูุฅูุฌุงุฒ.`)); 
                } catch(e) { alert(e.message); } 
                setLoad(false); 
            };

            return (
                <div className="animate-fade">
                    <div className="bg-navy p-8 rounded-t-3xl text-center border-b-[6px] border-gold">
                        <h2 className="text-3xl font-amiri text-gold font-bold">ูุฎุชุจุฑ ุงูููุงุฒู</h2>
                        <p className="text-white mt-2 opacity-90 text-lg">ูููุฏ ุงููุนูู ุงูุขูู ูุถูุฉ ููููุฉ ูุงูุนูุฉ ูุชููู ุจุงุณุชูุจุงุท ุงูุญูู ูููุง.</p>
                    </div>
                    <div className="bg-white p-8 rounded-b-3xl shadow-sm border border-t-0">
                        {!sc && <button onClick={gen} disabled={load} className="w-full bg-gold text-navy py-4 rounded-xl font-bold text-lg hover:bg-yellow-500 shadow-md transition">{load ? 'ูุชู ุงูุชูููุฏุ ุงูุชุธุฑ ููููุงู...' : 'ุชูููุฏ ูุงุฒูุฉ ููููุฉ ุฌุฏูุฏุฉ'}</button>}
                        {sc && (
                            <div className="space-y-6 animate-fade">
                                <div className="bg-blue-50 p-5 rounded-xl border-r-[6px] border-navy text-lg leading-relaxed text-navy font-medium shadow-inner">{sc}</div>
                                <textarea value={ans} onChange={e=>setAns(e.target.value)} placeholder="ุงูุชุจ ุญููู ุงููููู ููุง ุจูุงุก ุนูู ูุง ุฏุฑุณุช..." className="w-full p-4 border-2 border-gray-200 rounded-xl h-32 outline-none focus:border-gold resize-none text-lg transition shadow-sm" />
                                {!fb && <button onClick={evalAns} disabled={load||!ans.trim()} className="w-full bg-navy text-gold py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 disabled:opacity-50 transition shadow-md">{load ? 'ุฌุงุฑู ุงูุชุตุญูุญ...' : 'ุนุฑุถ ุฅุฌุงุจุชู ุนูู ุงููุตุญุญ ุงูุขูู'}</button>}
                                {fb && (
                                    <div className="bg-green-50 p-6 rounded-xl border-r-[6px] border-green-500 shadow-sm animate-fade">
                                        <h4 className="font-bold text-green-800 text-xl mb-3">ุงูุชุตุญูุญ:</h4>
                                        <p className="text-gray-800 leading-relaxed text-lg font-medium whitespace-pre-line">{fb}</p>
                                        <button onClick={()=>{setSc('');setFb('');}} className="mt-6 px-4 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition">ุฌุฑุจ ูุงุฒูุฉ ุฃุฎุฑู</button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const Quiz = ({ stu }) => {
            const [qIdx, setQIdx] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [done, setDone] = React.useState(false);
            const q = QUIZ[qIdx];

            const handle = async (i) => {
                const newScore = i === q.a ? score + 1 : score;
                if(i === q.a) setScore(newScore);
                
                if(qIdx < QUIZ.length - 1) {
                    setTimeout(() => setQIdx(qIdx + 1), 300);
                } else {
                    setDone(true);
                    const rec = { name: stu.n, sec: stu.s, score: newScore, date: new Date().toLocaleDateString('ar-SA'), ts: Date.now() };
                    saveRec(rec);
                    const url = getConf('gsURL');
                    if(url) {
                        try { fetch(`${url}?name=${encodeURIComponent(stu.n)}&section=${encodeURIComponent(stu.s)}&score=${newScore}/20`, {mode:'no-cors'}); } catch(e){}
                    }
                }
            };

            if(done) return (
                <div className="text-center py-16 bg-white rounded-3xl shadow-sm border border-gray-100 animate-fade">
                    <div className="w-32 h-32 mx-auto rounded-full border-[8px] border-gold flex items-center justify-center mb-6 bg-gray-50">
                        <span className="text-4xl font-bold text-navy">{score}/20</span>
                    </div>
                    <h2 className="text-3xl font-amiri font-bold text-navy mb-4">{score >= 12 ? 'ูุจุงุฑู! ุงุฌุชุฒุช ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ' : 'ุนููู ุงููุฑุงุฌุนุฉ ูุฌุฏุฏุงู ูุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ'}</h2>
                    <p className="text-gray-500 text-lg bg-gray-50 inline-block px-4 py-2 rounded-lg">ุชู ุชุณุฌูู ูุชูุฌุชู ูุญูุธูุง ูุฏู ุงูุฃุณุชุงุฐ.</p>
                </div>
            );

            return (
                <div className="animate-fade">
                    <div className="flex justify-between text-navy mb-3 font-bold text-lg px-2">
                        <span>ุงูุณุคุงู {qIdx+1} ูู 20</span>
                        <span>ุงูุฏุฑุฌุฉ ุญุชู ุงูุขู: {score}</span>
                    </div>
                    <div className="w-full bg-gray-200 h-3 rounded-full mb-8 shadow-inner overflow-hidden">
                        <div className="bg-gold h-3 rounded-full transition-all duration-300" style={{width: `${(qIdx/20)*100}%`}}></div>
                    </div>
                    
                    <div className="bg-white p-8 md:p-10 rounded-3xl shadow-sm border border-gray-200 text-center">
                        <h3 className="text-2xl font-amiri text-navy mb-8 leading-relaxed font-bold border-b border-gray-100 pb-6">{q.q}</h3>
                        <div className="space-y-4">
                            {q.o.map((opt, i) => (
                                <button key={i} onClick={()=>handle(i)} className="w-full p-4 text-right rounded-xl border-2 border-gray-100 hover:border-gold hover:bg-gold/10 transition font-medium text-navy text-lg shadow-sm">
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
